/*
 * JivaBenchUI.java
 *
 * Created on April 2, 2007, 4:38 PM
 */

package net.xofar.jiva.ui;

import java.awt.BorderLayout;

import javax.swing.UIManager;

import net.xofar.jiva.GAProblem;
import net.xofar.jiva.population.Chromosome;
import net.xofar.jiva.population.Population;
import net.xofar.util.listener.EventListener;

import com.sun.java.swing.plaf.windows.WindowsLookAndFeel;

/**
 * 
 * @author lalitp
 */
public class JivaBenchUI
        extends javax.swing.JFrame
{

    /** Creates new form JivaBenchUI */
    public JivaBenchUI()
    {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc=" Generated Code
    // <editor-fold defaultstate="collapsed" desc=" Generated Code
    // <editor-fold defaultstate="collapsed" desc=" Generated Code ">//GEN-BEGIN:initComponents
    private void initComponents() {
        jSplitPane1 = new javax.swing.JSplitPane();
        jPanel1 = new javax.swing.JPanel();
        jLabel1 = new javax.swing.JLabel();
        problemsCombo = new javax.swing.JComboBox(GAProblem.getProblems());
        runButton = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        popSize = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        chrSize = new javax.swing.JTextField();
        jLabel4 = new javax.swing.JLabel();
        numIters = new javax.swing.JTextField();
        jLabel5 = new javax.swing.JLabel();
        optimalSol = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        desc = new javax.swing.JTextArea();
        gaCanvasHolder = new javax.swing.JScrollPane();
        gaCanvas = new GACanvas();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Jiva Demo");
        setBounds(new java.awt.Rectangle(75, 75, 900, 500));
        jSplitPane1.setDividerLocation(325);
        jSplitPane1.setOneTouchExpandable(true);
        jPanel1.setBorder(javax.swing.BorderFactory.createTitledBorder("GA Problem Definition"));
        problemsComboActionPerformed(null);
        jLabel1.setText("Problem:");

        problemsCombo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                problemsComboActionPerformed(evt);
            }
        });

        runButton.setText("Run");
        runButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                runButtonActionPerformed(evt);
            }
        });

        jLabel2.setText("Population Size:");

        popSize.setEditable(false);

        jLabel3.setText("Chromosome Size");

        chrSize.setEditable(false);

        jLabel4.setText("Num Evolutions");

        numIters.setEditable(false);

        jLabel5.setText("Optimal Solution:");

        optimalSol.setEditable(false);

        jLabel6.setText("Description:");

        desc.setColumns(20);
        desc.setEditable(false);
        desc.setFont(new java.awt.Font("SansSerif", 0, 12));
        desc.setLineWrap(true);
        desc.setRows(5);
        desc.setWrapStyleWord(true);
        jScrollPane1.setViewportView(desc);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel1Layout.createSequentialGroup()
                        .addGap(22, 22, 22)
                        .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 278, Short.MAX_VALUE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel2, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel1, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel3, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jLabel4, javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jLabel6)
                                .addComponent(jLabel5)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(popSize, javax.swing.GroupLayout.DEFAULT_SIZE, 179, Short.MAX_VALUE)
                            .addComponent(problemsCombo, 0, 179, Short.MAX_VALUE)
                            .addComponent(chrSize, javax.swing.GroupLayout.DEFAULT_SIZE, 179, Short.MAX_VALUE)
                            .addComponent(numIters, javax.swing.GroupLayout.DEFAULT_SIZE, 179, Short.MAX_VALUE)
                            .addComponent(optimalSol, javax.swing.GroupLayout.DEFAULT_SIZE, 179, Short.MAX_VALUE)))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                        .addContainerGap(245, Short.MAX_VALUE)
                        .addComponent(runButton)))
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(problemsCombo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(popSize, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(chrSize, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel4)
                    .addComponent(numIters, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel5)
                    .addComponent(optimalSol, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel6)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 169, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(runButton)
                .addContainerGap(62, Short.MAX_VALUE))
        );
        jSplitPane1.setLeftComponent(jPanel1);

        gaCanvasHolder.setBorder(javax.swing.BorderFactory.createTitledBorder("GA Solution Trace"));
        gaCanvasHolder.setHorizontalScrollBarPolicy(javax.swing.ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
        gaCanvasHolder.setVerticalScrollBarPolicy(javax.swing.ScrollPaneConstants.VERTICAL_SCROLLBAR_NEVER);
        javax.swing.GroupLayout gaCanvasLayout = new javax.swing.GroupLayout(gaCanvas);
        gaCanvas.setLayout(gaCanvasLayout);
        gaCanvasLayout.setHorizontalGroup(
            gaCanvasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 448, Short.MAX_VALUE)
        );
        gaCanvasLayout.setVerticalGroup(
            gaCanvasLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 471, Short.MAX_VALUE)
        );
        gaCanvasHolder.setViewportView(gaCanvas);

        jSplitPane1.setRightComponent(gaCanvasHolder);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jSplitPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 756, Short.MAX_VALUE)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jSplitPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 475, Short.MAX_VALUE)
                .addContainerGap())
        );
        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void problemsComboActionPerformed(java.awt.event.ActionEvent evt)
    {// GEN-FIRST:event_problemsComboActionPerformed
        GAProblem<?> problem = (GAProblem<?>)problemsCombo.getSelectedItem();
        popSize.setText(String.valueOf(problem.getPopulationSize()));
        chrSize.setText(String.valueOf(problem.getChromosomeSize()));
        numIters.setText(String.valueOf(problem.getNumEvolutions()));
        optimalSol.setText(String.valueOf(problem.getOptimalSolution()));
        desc.setText(problem.getDescription());
        desc.setCaretPosition(0);
    }// GEN-LAST:event_problemsComboActionPerformed

    private void runButtonActionPerformed(java.awt.event.ActionEvent evt)
    {// GEN-FIRST:event_runButtonActionPerformed
        runButton.setEnabled(false);
        new Thread(new Runnable()
        {
            public void run()
            {
                GAProblem<?> problem = (GAProblem<?>)problemsCombo
                        .getSelectedItem();
                run(problem);
            }

            private <T> void run(GAProblem<T> problem)
            {
                GACanvas gac = (GACanvas)gaCanvas;
                gac.init(problem.getNumEvolutions(), problem.getOptimalSolution());
                EventListener<Population<T>> listener = new UiGAListener<T>(gac);
                Population<T> finalPop = problem.getEvolver().run(problem,
                        listener);

                Chromosome<T> fittest = finalPop.determineFittestChromosome();
                double best = fittest.getFitnessValue();
                System.out.format(
                        "\nFittest Chromosome in Final generation is: %s\n",
                        fittest.toString());
                System.out.format("Fittest Chromosome has value: %.3f\n", best);
                runButton.setEnabled(true);
            }
        }).start();

    }// GEN-LAST:event_runButtonActionPerformed

    /**
     * @param args
     * the command line arguments
     */
    public static void main(String args[])
            throws Exception
    {
        UIManager.setLookAndFeel(new WindowsLookAndFeel());
        java.awt.EventQueue.invokeLater(new Runnable()
        {
            public void run()
            {
                new JivaBenchUI().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField chrSize;
    private javax.swing.JTextArea desc;
    private javax.swing.JPanel gaCanvas;
    private javax.swing.JScrollPane gaCanvasHolder;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JSplitPane jSplitPane1;
    private javax.swing.JTextField numIters;
    private javax.swing.JTextField optimalSol;
    private javax.swing.JTextField popSize;
    private javax.swing.JComboBox problemsCombo;
    private javax.swing.JButton runButton;
    // End of variables declaration//GEN-END:variables

}
